import { createClient, SupabaseClient } from '@supabase/supabase-js';
import { Unit, Listing } from '../types';

// Define a type for your database schema
export interface Database {
  public: {
    Tables: {
      profiles: {
        Row: {
          id: number
          username: string | null
          first_name: string | null
          balance: number
          inventory: Unit[] | null
          achievements: string[] | null
        }
        Insert: {
          id: number
          username?: string | null
          first_name?: string | null
          balance?: number
          inventory?: Unit[] | null
          achievements?: string[] | null
        }
        Update: {
          id?: number
          username?: string | null
          first_name?: string | null
          balance?: number
          inventory?: Unit[] | null
          achievements?: string[] | null
        }
        Relationships: []
      }
      listings: {
        Row: Listing
        Insert: {
          id?: string // uuid is generated by db
          seller_id: number;
          seller_username: string;
          unit_data: Unit;
          asking_price: number;
          status?: 'active' | 'completed' | 'cancelled';
        }
        Update: {
            status?: 'active' | 'completed' | 'cancelled';
        }
        Relationships: [
            {
              foreignKeyName: 'listings_seller_id_fkey'
              columns: ['seller_id']
              referencedRelation: 'profiles'
              referencedColumns: ['id']
            }
        ]
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      [_ in never]: never
    }
    Enums: {
      [_ in never]: never
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

/*
 * =============================================================================
 * =============================================================================
 * 
 *    üëâüëâüëâ  ACTION REQUIRED: CONFIGURE YOUR SUPABASE CONNECTION  üëàüëàüëà
 * 
 * =============================================================================
 * =============================================================================
 *
 *    Hello! For this app to work, you MUST connect it to your own Supabase
 *    database project. This is easy to do!
 *
 *    Follow these steps to get your project's URL and Key:
 *
 *    1.  Go to your Supabase project dashboard:
 *        https://supabase.com/dashboard
 *
 *    2.  In your project, go to "Project Settings" (the gear icon ‚öôÔ∏è).
 *
 *    3.  Click on "API" in the settings menu.
 *
 *    4.  Under the "Project API keys" section, find:
 *        - The "Project URL"
 *        - The "public" key (also called the "anon" key).
 *
 *    5.  COPY the URL and the public key and PASTE them into the variables
 *        below, replacing the placeholder text.
 *
 *    ‚úÖ After you do this, save the file and the app will connect!
 *
 * =============================================================================
 *    –†–£–°–°–ö–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø
 * =============================================================================
 *
 *    –ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ, –≤—ã –î–û–õ–ñ–ù–´ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ–≥–æ –∫
 *    –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É –≤ Supabase. –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ!
 *
 *    1.  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Supabase: https://supabase.com/dashboard
 *    2.  –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–π–¥–∏—Ç–µ –≤ "Project Settings" (–∏–∫–æ–Ω–∫–∞ ‚öôÔ∏è).
 *    3.  –ù–∞–∂–º–∏—Ç–µ –Ω–∞ "API" –≤ –º–µ–Ω—é.
 *    4.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ "Project URL" –∏ "public" ("anon") –∫–ª—é—á.
 *    5.  –í–°–¢–ê–í–¨–¢–ï –∏—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∏–∂–µ, –∑–∞–º–µ–Ω–∏–≤ —Ç–µ–∫—Å—Ç-–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å.
 *
 *    ‚úÖ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è!
 * =============================================================================
 */
const supabaseUrl = 'https://lakvibnhoebryfuuompn.supabase.co'; // <--- ‚úÖ –Ø –í–°–¢–ê–í–ò–õ –í–ê–® URL
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxha3ZpYm5ob2VicnlmdXVvbXBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwMzM0MjksImV4cCI6MjA3NjYwOTQyOX0.Xy04UdJonrGm9RCf1BCPXsoNLCCBzzzvoLuNJiwjqcM';      // <--- ‚úÖ –Ø –í–°–¢–ê–í–ò–õ –í–ê–® –ö–õ–Æ–ß


// The App.tsx component will handle connection errors gracefully
// if these variables are not set correctly.
let supabase: SupabaseClient<Database> | null = null;

if (supabaseUrl && supabaseAnonKey && !supabaseUrl.includes('YOUR_PROJECT_ID') && !supabaseAnonKey.includes('YOUR_PUBLIC_ANON_KEY')) {
    try {
        supabase = createClient<Database>(supabaseUrl, supabaseAnonKey);
    } catch (error) {
        console.error("Error creating Supabase client:", error);
    }
} else {
    // This message will appear in the browser console if the credentials are not set.
    // The UI in App.tsx will also show a user-friendly error message.
    console.error("Supabase credentials are not set. Please edit `lib/supabase.ts` and replace the placeholder values.");
}

export { supabase };
